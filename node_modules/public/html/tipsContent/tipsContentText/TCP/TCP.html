<div>
    <p class="contentTitle">TCP/IP协议</p>
    <ol>
        <li>
            http协议
        </li>
        <li>
            websocket协议
            <p>websocket是一种网络通信协议。因为 HTTP 协议有一个缺陷：通信只能由客户端发起。从而websocket诞生了。之前服务器只能通过“轮询”的方式向客户端发送消息：
                即定每隔一段时间向服务器发送消息，然后服务器响应。websocket的最大特点就是，服务器可以主动向客户端推送信息，客户端也可以主动向服务器发送信息，是真正的双向平等对话，属于服务器推送技术的一种。</p>
            <div id="showMessage">
                <p>内容显示区域</p>
            </div>
            <div>
                <input id="inputMessage" type="text" placeholder="请输入内容"/>
                <button ng-click="testWebSocket()">测试websocket</button>
            </div>

            <xmp>
                <!--服务器端-->
                //nodejs中搭建websocket服务
                1、npm 安装ws  选择安装路径后，直接npm install ws
                2、引入var WebSocketServer = require('ws').Server;
                3、添加监听端口 var wss = new WebSocketServer({ port: 8080 });
                4、建立连接：
                wss.on('connection', function (ws) {
                    //console.log('client connected'); //接收客户端发来的连接请求，连接成功以后，执行回调函数，才能接收消息。
                    ws.on('message', function (message) { //接收消息
                        console.log(message);
                        ws.send(message);  //向客户端发送消息
                    });
                });

                <!--客户端-->
                var ws = new WebSocket("ws://localhost:8080");
                var sendMsg = $("#inputMessage").val();
                var ws = new WebSocket("ws://localhost:8080");
                ws.onopen = function (e) {
                    if(sendMsg && sendMsg != ""){
                    ws.send(sendMsg); //注意：回调函数，必须要等到建立起链接后才能发送数据
                }else{
                    alert("提交有效数据")
                }
                ws.onmessage = function (evt) {
                    var receiveMessage = evt.data;
                    $("#showMessage").append($("<p> " + receiveMessage + " </p>"));
                        ws.close(); //每次发送接收完数据后就关闭
                    };
                }
                ws.onclose = function() {  //监听关闭链接的回调函数
                    console.log("连接已关闭...");
                };


                监听事件类型：
                ws.onopen	连接建立时触发
                ws.onmessage	客户端接收服务端数据时触发
                ws.onerror	通信发生错误时触发
                ws.onclose	连接关闭时触发
                eg: ws.onclose = function() {  //监听关闭链接的回调函数
                        console.log("连接已关闭...");
                    };

                方法种类：
                ws.send()   使用连接发送数据,注意，需要将对象转换为字符串发送到服务端
                ws.close()  关闭连接
            </xmp>

            <div>
                websocket.io测试
                <div>
                    <button ng-click="openSocket()">socket.io打开链接</button>
                </div>
            </div>
            <xmp>
                //nodejs中搭建websocket.io实现聊天功能
                nodejs中的express框架
                var express = require('express');
                var app = express();

                1、npm install socket.io
                2、var server1 = require('http').createServer(app);
                3、var io = require('socket.io')(server1);
                4、监听端口 server1.listen(8000);
                io.on('connection', function(socket) {
                    //接收并处理客户端的hi事件
                    socket.on('user-service', function(data) {
                        console.log(data);
                        //触发客户端事件c_hi
                        socket.emit('service-user',data); //向自己发送消息
                        socket.broadcast.emit('outMsg',data); ////用于向整个网络广播(除自己之外)
                    })

                    //断开事件
                    //socket.on('disconnect', function(data) {
                    //    console.log('断开',data)
                    //    socket.emit('c_leave','离开');
                    //})
                });

                客户端
                1、引入<script src="../../../../js/socket.io.js"></script>
                //打开链接
                2、var socket = io.connect('localhost:8000');//与服务器进行连接
                3、  //接收来自服务端的个人信息事件
                socket.on('service-user',function(msg){
                    var div = document.createElement("div");
                    var childDiv = document.createElement("div");
                    childDiv.setAttribute("class","self-msg");
                    div.setAttribute("class","item");
                    childDiv.innerHTML = msg;
                    div.appendChild(childDiv);
                    dialogBody.appendChild(div);
                })
                4、//    接收来自服务端的广播事件
                socket.on('outMsg',function(msg){
                    var div = document.createElement("div");
                    var childDiv = document.createElement("div");
                    childDiv.setAttribute("class","other-msg");
                    div.setAttribute("class","item");
                    childDiv.innerHTML = msg;
                    div.appendChild(childDiv);
                    dialogBody.appendChild(div);
                })
                5、向服务端发送消息 socket.emit('user-service',value);
            </xmp>
        </li>
    </ol>
</div>