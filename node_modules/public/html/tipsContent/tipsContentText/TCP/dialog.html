<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="./dialog.css"/>

    <script src="../../../../js/socket.io.js"></script>
</head>
<body>
    <div class="dialog">
        <!--<div class="dialog-title">-->
            <!--这是一个模仿QQ的对话框-->
        <!--</div>-->

        <!--对话内容展示区域-->
        <div class="dialog-body">
            <div class="item">
                <div class="self-msg">
                    自己说的内容
                </div>
            </div>
            <div class="item">
                <div class="other-msg">
                    其他人说的内容
                </div>
            </div>
        </div>

        <div class="dialog-bottom">
            <div class="input-content">
                <textarea id="msg" autofocus placeholder="请输入内容" style="resize: none;">

                </textarea>
            </div>

            <div class="sendMsg">
                <button class="sendMsg-button" onclick="sendMsg()">发送消息</button>
            </div>

        </div>
    </div>
</body>
<script>
    //websocket.io实例
    //打开链接
    var socket = io.connect('localhost:8000');//与服务器进行连接
    var dialogBody = document.getElementsByClassName("dialog-body")[0];

    //接收来自服务端的个人信息事件
    socket.on('service-user',function(msg){
//        alert(msg);
        var div = document.createElement("div");
        var childDiv = document.createElement("div");
        childDiv.setAttribute("class","self-msg");
        div.setAttribute("class","item");
        childDiv.innerHTML = msg;
        div.appendChild(childDiv);
        dialogBody.appendChild(div);
    })

//    接收来自服务端的广播事件
    socket.on('outMsg',function(msg){
//        alert(msg);
        var div = document.createElement("div");
        var childDiv = document.createElement("div");
        childDiv.setAttribute("class","other-msg");
        div.setAttribute("class","item");
        childDiv.innerHTML = msg;
        div.appendChild(childDiv);
        dialogBody.appendChild(div);
    })

    //断开链接
//    socket.close();

//    发送消息
    function sendMsg(){
        var value = document.getElementById("msg").value;
//        console.log(value);
        socket.emit('user-service',value);
    }
</script>
</html>