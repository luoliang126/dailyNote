/**
 * Created by ly on 2017/5/19.
 */
app.controller("TCPcontroller",function($scope){

    $scope.testWebSocket = function(){
        var sendMsg = $("#inputMessage").val();
        var ws = new WebSocket("ws://localhost:8080");
        ws.onopen = function (e) {
            if(sendMsg && sendMsg != ""){
                ws.send(sendMsg); //注意：回调函数，必须要等到建立起链接后才能发送数据
            }else{
                alert("提交有效数据")
            }
            ws.onmessage = function (evt) {
                var receiveMessage = JSON.stringify(evt.data);
                $("#showMessage").append($("<p> " + receiveMessage + " </p>"));
                ws.close(); //每次发送接收完数据后就关闭
            };
        }
        ws.onclose = function() {  //监听关闭链接的回调函数
            console.log("连接已关闭...");
        };
    }

    //websocket.io实例
    var socket;
    //打开链接
    $scope.openSocket = function(){
        socket = io.connect('localhost:8000');//与服务器进行连接
        //接收来自服务端的信息事件c_hi
        socket.on('c_hi',function(msg){
            alert(msg)
        })

        socket.on('c_leave',function(msg){
            alert(msg);
        });
    }
    //操作发送消息
    $scope.socketIO = function(){
        socket.emit('hi', 'hello!');
        socket.on('outMsg',function(msg){
            alert(msg)
        })
    }
    //断开链接
    $scope.leaveSocket = function(){
        socket.close();
    }


})
