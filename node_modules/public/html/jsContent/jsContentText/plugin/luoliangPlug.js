/**
 * Created by ly on 2017/5/2.
 */
//原生js插件封装
//说明：依赖库组件:jquery,bootstrap,FontAwesome图标库
(function($){
    //弹窗组件(自己制作弹窗，可以基于jq的layer弹窗，界面更加丰富多彩)
    var Layer = function(config){
        this.config = {
            layerType:"alert", //弹窗的类型
            width:"860",    //弹窗的宽高
            height:"560",
            title:"弹窗标题", //弹窗的标题
            url:"",   //iframe加载时的路径
            content:""  //提示或弹框的内容
        };
        $.extend(this.config,config);

        this.windowWidth = document.body.offsetWidth;
        this.windowHeight = document.body.offsetHeight;

        switch (this.config.layerType){
            case "tips":
                this.tips();
                break;
            case "alert":
                this.shadeDiv = $("<div class='layer-shadow'></div>");
                this.outDiv = $("<div class='luoliangLayer' id='luoliangLayer'></div>");
                this.alert();
                break;
        }
    };
    Layer.prototype = {
        //提示性弹框，3s后自动消失
        tips:function(){
            var outDivForTips = $("<div class='luoliangTips' id='luoliangTips'></div>");
            outDivForTips.html(this.config.content);
            outDivForTips.appendTo($("body"));
            setTimeout(function(){
                outDivForTips.remove();
            },3000)
        },
        // 一般弹框
        alert:function(){
            var divHeader = $("<div class='layerHeader'><i class='fa fa-tasks'></i><span id='layerTitle'> "+ this.config.title+ " </span></div>");
            var divClose = $("<i class='layerCloseBtn fa fa-times' title='关闭'></i>")
            var divBody = $("<div class='layerBody'></div>");

            this.outDiv.css({
                width:this.config.width,
                height:this.config.height,
                left:(this.windowWidth - this.config.width)/2,
                top:(this.windowHeight - this.config.height)/2
            });
            divBody.css({
                width:this.config.width,
                height:this.config.height - 40
            });

            if(this.config.content){
                divBody.html(this.config.content);
            }
            if(this.config.url){
                var iframeEle = $("<iframe class='layerIframe'></iframe>");
                iframeEle.attr("src",this.config.url);
                iframeEle.appendTo(divBody);
            }

            divClose.appendTo(divHeader);
            divHeader.appendTo(this.outDiv);
            divBody.appendTo(this.outDiv);
            this.shadeDiv.appendTo($("body"));
            this.outDiv.appendTo($("body"));

            var that = this;  //this指向，方便调用
            divClose.on("click",function(){
                that.closeBtn();
            })
        },

        //关闭弹窗按钮
        closeBtn:function(){
            this.shadeDiv.remove();
            this.outDiv.remove();
        }
    }
    window.Layer = Layer; //暴露出去


    //tab选项卡插件
    var Tab = function(config,selectId){
        var newConfig; //整合后的配制信息

        //默认配制参数
        this.config = {
            eventType:"click", //定义事件类型
            animate:"fade", //定义动画效果
            invoke:"1",  //默认展示第几个
            auto:"1"  //定义动画时间 0:不自动播放，1:默认自动播放（时长5000），传具体参数
        }

        if(config && config !=""){
            newConfig = this.getConfig(config);
        }else{

        }

        //绑定方法
        $(selectId).find(".tab-nav-item").bind(this.config.eventType,function(){
            $(this).addClass("tab-nav-active").siblings().removeClass("tab-nav-active");
            var index = $(this).index();
            $(".tab-content li").removeClass("tab-content-active").eq(index).fadeIn().siblings().fadeOut();
        })

        //自动播放效果
        if(this.config.auto == "0"){

        }else if(this.config.auto == "1"){
            this.autoPlay("5000");
        }else{
            this.autoPlay();
        }

    };
    Tab.prototype = {
        //获取配制参数信息
        getConfig:function(config){
            return $.extend(this.config,config);  //jquery的$.extend扩展方法，把第二个参数中的属性和值往第一个参数中扩展，有就覆盖，没有就添加.
        },
        //自动播放(轮播)
        autoPlay:function(setTime){
            var totalTime;
            if(setTime){
                totalTime = setTime;
            }else{
                totalTime = this.config.auto;
            };

            var index = 0; //循环时间
            var indexPic = 0 //循环图片
            setInterval(function(){
                ++index;
                if(index*1000 == totalTime){
                    if(indexPic <= $(".tab-content").find("li").length - 2){
                        ++indexPic;
                    }else{
                        indexPic = 0;
                    }
                    $(".tab-nav li").eq(indexPic).addClass("tab-nav-active").siblings().removeClass("tab-nav-active");
                    $(".tab-content li").eq(indexPic).fadeIn().siblings().fadeOut();
                    index = 0;
                }
            },1000);
        }
    };
    window.Tab = Tab;  //暴露出去

})(jQuery);